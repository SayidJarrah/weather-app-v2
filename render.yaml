version: "1"

databases:
  - name: weather-app-db
    plan: free
    databaseName: weather_app
    user: weather_app
    # region: frankfurt

services:
  - type: web
    name: weather-backend
    runtime: docker
    plan: starter            # âœ… not "free"
    image:
      registryCredential: ghcr
      url: ghcr.io/sayidjarrah/weather-backend:latest
    healthCheckPath: /actuator/health
    envVars:
      - key: PORT
        value: "8080"
      - key: DATASOURCE_URL
        fromDatabase:
          name: weather-app-db
          property: connectionString
      - key: DATASOURCE_USERNAME
        fromDatabase:
          name: weather-app-db
          property: user
      - key: DATASOURCE_PASSWORD
        fromDatabase:
          name: weather-app-db
          property: password

  - type: web
    name: weather-frontend
    runtime: docker
    plan: free
    image:
      registryCredential: ghcr
      url: ghcr.io/sayidjarrah/weather-frontend:latest
    routes:
      - type: rewrite
        source: "/*"
        destination: "/index.html"

registryCredentials:
  - name: ghcr
    server: ghcr.io
    username: ${GHCR_USERNAME}
    password: ${GHCR_PASSWORD}
